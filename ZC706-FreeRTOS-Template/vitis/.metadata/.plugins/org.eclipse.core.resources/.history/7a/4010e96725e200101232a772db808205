#include "FreeRTOS.h"
#include "task.h"
#include "sys_core.h"
#include "xil_printf.h"
#include "xuartps_hw.h"

volatile LedMode_t g_CurrentMode = MODE_WATERFALL;

void Task_UART_Cmd(void *pvParameters)
{
    u8 RecvChar;
    u32 UartBaseAddr = STDIN_BASEADDRESS;

    xil_printf("\r\n=== ZC706 Fun Pack ===\r\n");
    xil_printf("1: Classic Waterfall\r\n");
    xil_printf("2: Switch Direct Control\r\n");
    xil_printf("3: Binary Counter (Use SW1-SW3 to ctrl)\r\n");
    xil_printf("4: Electronic Dice (Toggle SW4 to roll)\r\n");
    xil_printf("0: Turn Off\r\n");

    for (;;) {
        if (XUartPs_IsReceiveData(UartBaseAddr)) {
            RecvChar = XUartPs_ReadReg(UartBaseAddr, XUARTPS_FIFO_OFFSET);
            switch(RecvChar) {
                case '1': g_CurrentMode = MODE_WATERFALL;   xil_printf(">> Set: Waterfall\r\n"); break;
                case '2': g_CurrentMode = MODE_SWITCH_CTRL; xil_printf(">> Set: Direct Switch\r\n"); break;
                case '3': g_CurrentMode = MODE_BINARY_CNT;  xil_printf(">> Set: Binary Counter\r\n"); break;
                case '4': g_CurrentMode = MODE_DICE_GAME;   xil_printf(">> Set: Dice Game\r\n"); break;
                case '0': g_CurrentMode = MODE_OFF;         xil_printf(">> Set: OFF\r\n"); break;
            }
        }
        vTaskDelay(pdMS_TO_TICKS(50));
    }
}
